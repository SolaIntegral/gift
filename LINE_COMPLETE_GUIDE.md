# LINE設定完了ガイド

## 🎉 設定完了！

LINE Messaging APIの設定が完了しました。以下の手順で動作確認を行ってください。

## 📋 動作確認手順

### 1. LINE Developers Console設定確認
- [LINE Developers Console](https://developers.line.biz/)にアクセス
- 作成したチャンネルの設定を確認
- **Webhook URL**: `https://jquzcc3vd0.execute-api.us-west-2.amazonaws.com/prod/line-webhook`
- **Webhookの利用**: 有効
- **検証**: 有効

### 2. LINEアプリでの友達追加
1. LINEアプリを開く
2. 作成したチャンネルのQRコードをスキャン
3. または、チャンネルのユーザーIDで友達追加

### 3. テストメッセージ送信
以下のメッセージを送信して動作確認：

#### 基本機能テスト
```
ヘルプ
```
期待される応答：
```
❓ ヘルプ

以下の機能をご利用いただけます：

🎁 ギフト相談
「ギフト相談」と送信してください

📋 注文確認
「注文確認 [注文ID]」と送信してください

❓ ヘルプ
「ヘルプ」と送信してください
```

#### ギフト相談テスト
```
ギフト相談
```
期待される応答：
```
🎁 ギフト相談を開始します！

以下の質問にお答えください：

1️⃣ 予算はどのくらいですか？
- 5000-10000円
- 10000-20000円
- 20000-30000円
- 30000-50000円
- 50000円以上

「予算: [選択肢]」と送信してください
```

#### 注文確認テスト
```
注文確認
```
期待される応答：
```
📋 注文確認

注文IDを指定してください：
「注文確認 [注文ID]」
```

## 🎯 利用可能な機能

### 1. ギフト相談機能
- **AI推薦**: Amazon Bedrock (Claude 3 Sonnet) を使用
- **対話形式**: 予算、相手、シーンを順次質問
- **クイックリプライ**: 選択肢をボタンで表示

### 2. 注文管理機能
- **注文確認**: 注文IDによる状況確認
- **注文履歴**: ユーザーの注文履歴表示
- **リアルタイム更新**: 注文状況の最新情報

### 3. ヘルプ機能
- **機能説明**: 利用可能な機能の説明
- **使い方ガイド**: 各機能の使用方法
- **エラー対応**: 問題発生時の対処法

## 🔧 トラブルシューティング

### よくある問題と対処法

#### 1. メッセージが応答しない
```bash
# ログを確認
aws logs tail /aws/lambda/AwsInfrastructureStack-LineWebhookFunction --follow
```

#### 2. 署名検証エラー
- チャンネルシークレットが正しく設定されているか確認
- 環境変数を再設定：
```bash
./setup-line.sh
```

#### 3. データベース接続エラー
- RDSインスタンスが起動しているか確認
- セキュリティグループの設定を確認

#### 4. AI機能が動作しない
- Bedrock APIの権限設定を確認
- モデルIDが正しく設定されているか確認

## 📊 監視とログ

### CloudWatchログ確認
```bash
# リアルタイムログ
aws logs tail /aws/lambda/AwsInfrastructureStack-LineWebhookFunction --follow

# 特定の時間範囲
aws logs filter-log-events \
  --log-group-name /aws/lambda/AwsInfrastructureStack-LineWebhookFunction \
  --start-time $(date -d '1 hour ago' +%s)000
```

### メトリクス確認
- AWS CloudWatchでLambda関数のメトリクスを確認
- エラー率、実行時間、呼び出し回数を監視

## 🚀 次のステップ

### 1. 本格運用開始
- ユーザーテストの実施
- フィードバックの収集
- 機能の改善・拡張

### 2. 機能拡張の検討
- 決済機能の統合
- 画像認識機能の追加
- 多言語対応
- プッシュ通知機能

### 3. 運用監視の強化
- アラート設定
- パフォーマンス監視
- セキュリティ監査

## 📞 サポート

問題が発生した場合は、以下を確認してください：

1. **CloudWatchログ**: エラーの詳細を確認
2. **LINE Developers Console**: Webhook設定を確認
3. **AWS Lambda**: 環境変数と権限を確認
4. **RDS**: データベース接続を確認

## 🎊 おめでとうございます！

LINE Botの設定が完了しました。健康ギフトプラットフォームのLINE統合が実現され、ユーザーはLINEを通じてAIによるギフト相談や注文管理を利用できるようになりました。 