<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚®ãƒ•ãƒˆã‚’é¸æŠ - GIFT</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">ğŸ GIFT</a>
            <nav>
                <ul class="nav-menu">
                    <li><a href="about.html">GIFTã«ã¤ã„ã¦</a></li>
                    <li><a href="send_gifts.html">ã‚®ãƒ•ãƒˆã‚’é€ã‚‹</a></li>
                    <li><a href="mypage.html">ãƒã‚¤ãƒšãƒ¼ã‚¸</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="main-content">
        <!-- ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
        <section class="step-indicator">
            <div class="step active">
                <div class="step-number">1</div>
                <span>ã‚®ãƒ•ãƒˆã‚’é¸æŠ</span>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <span>ç›¸æ‰‹ã®æƒ…å ±ã‚’å…¥åŠ›</span>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <span>æ±ºæ¸ˆå®Œäº†</span>
            </div>
        </section>

        <!-- ã‚®ãƒ•ãƒˆé¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="gift-selection">
            <div class="card">
                <h2>ã‚®ãƒ•ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
                <p>é€ã‚ŠãŸã„å¥åº·è¨ºæ–­ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãŠé¸ã³ãã ã•ã„</p>
                
                <div class="grid grid-3" id="gift-container">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>
        </section>

        <!-- é¸æŠç¢ºèªã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="selection-confirmation" id="confirmation-section" style="display: none;">
            <div class="card">
                <h2>é¸æŠã—ãŸã‚®ãƒ•ãƒˆã®ç¢ºèª</h2>
                <div id="selected-gift-info">
                    <!-- é¸æŠã•ã‚ŒãŸã‚®ãƒ•ãƒˆã®æƒ…å ±ã‚’è¡¨ç¤º -->
                </div>
            </div>
        </section>

        <!-- ç›¸æ‰‹æƒ…å ±å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
        <section class="recipient-form" id="recipient-form" style="display: none;">
            <div class="card">
                <h2>ç›¸æ‰‹ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
                <form id="gift-form">
                    <div class="form-group">
                        <label for="recipient-name">ãŠåå‰ *</label>
                        <input type="text" id="recipient-name" name="recipientName" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="recipient-email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *</label>
                        <input type="email" id="recipient-email" name="recipientEmail" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="recipient-phone">é›»è©±ç•ªå·</label>
                        <input type="tel" id="recipient-phone" name="recipientPhone" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="message">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
                        <textarea id="message" name="message" class="form-control" rows="4" placeholder="ç›¸æ‰‹ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="delivery-date">å¸Œæœ›é…é”æ—¥</label>
                        <input type="date" id="delivery-date" name="deliveryDate" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>é…é”æ–¹æ³•</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="delivery-email" name="deliveryMethod" value="email" checked>
                                <label for="delivery-email">ãƒ¡ãƒ¼ãƒ«é…é”ï¼ˆå³åº§ã«é…é”ï¼‰</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="delivery-scheduled" name="deliveryMethod" value="scheduled">
                                <label for="delivery-scheduled">æŒ‡å®šæ—¥æ™‚é…é”</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ã‚ªãƒ—ã‚·ãƒ§ãƒ³</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="option-card" name="options" value="card">
                                <label for="option-card">ã‚®ãƒ•ãƒˆã‚«ãƒ¼ãƒ‰ä»˜ãï¼ˆ+Â¥500ï¼‰</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="option-wrapping" name="options" value="wrapping">
                                <label for="option-wrapping">ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ+Â¥1,000ï¼‰</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="price-summary" id="price-summary">
                        <!-- ä¾¡æ ¼ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º -->
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="goBack()">æˆ»ã‚‹</button>
                        <button type="submit" class="btn btn-success">æ±ºæ¸ˆã«é€²ã‚€</button>
                    </div>
                </form>
            </div>
        </section>
    </main>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2024 GIFT. All rights reserved.</p>
            <p>å¤§åˆ‡ãªäººã¸å¥åº·ã‚’è´ˆã‚‹ - GIFT</p>
        </div>
    </footer>

    <script src="js/script.js"></script>
    <script>
        let selectedGift = null;
        let currentStep = 1;

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initGiftSelection();
            initFormHandlers();
        });

        // ã‚®ãƒ•ãƒˆé¸æŠã®åˆæœŸåŒ–
        function initGiftSelection() {
            const giftContainer = document.getElementById('gift-container');
            if (!giftContainer) return;

            const giftHTML = giftData.gifts.map(gift => `
                <div class="gift-card" data-gift-id="${gift.id}" onclick="selectGift(${gift.id})">
                    <div class="icon">${gift.icon}</div>
                    <h3>${gift.name}</h3>
                    <p>${gift.description}</p>
                    <div class="price">Â¥${gift.price.toLocaleString()}</div>
                </div>
            `).join('');

            giftContainer.innerHTML = giftHTML;
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®åˆæœŸåŒ–
        function initFormHandlers() {
            const form = document.getElementById('gift-form');
            if (form) {
                form.addEventListener('submit', handleFormSubmit);
            }

            // ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¤‰æ›´æ™‚ã®ä¾¡æ ¼æ›´æ–°
            const optionCheckboxes = document.querySelectorAll('input[name="options"]');
            optionCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updatePriceSummary);
            });
        }

        // ã‚®ãƒ•ãƒˆé¸æŠå‡¦ç†
        function selectGift(giftId) {
            selectedGift = giftData.gifts.find(gift => gift.id === giftId);
            
            // é¸æŠçŠ¶æ…‹ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            document.querySelectorAll('.gift-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            const selectedCard = document.querySelector(`[data-gift-id="${giftId}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }

            // é¸æŠç¢ºèªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            showConfirmation();
            
            console.log('é¸æŠã•ã‚ŒãŸã‚®ãƒ•ãƒˆ:', selectedGift);
        }

        // é¸æŠç¢ºèªã®è¡¨ç¤º
        function showConfirmation() {
            const confirmationSection = document.getElementById('confirmation-section');
            const selectedGiftInfo = document.getElementById('selected-gift-info');
            
            if (selectedGift && confirmationSection && selectedGiftInfo) {
                selectedGiftInfo.innerHTML = `
                    <div class="selected-gift-details">
                        <div class="icon">${selectedGift.icon}</div>
                        <h3>${selectedGift.name}</h3>
                        <p>${selectedGift.description}</p>
                        <div class="price">Â¥${selectedGift.price.toLocaleString()}</div>
                    </div>
                    <div class="confirmation-actions">
                        <button class="btn btn-success" onclick="proceedToForm()">ã“ã®ã‚®ãƒ•ãƒˆã§é€²ã‚€</button>
                        <button class="btn btn-secondary" onclick="changeSelection()">é¸æŠã‚’å¤‰æ›´</button>
                    </div>
                `;
                
                confirmationSection.style.display = 'block';
                confirmationSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ã«é€²ã‚€
        function proceedToForm() {
            document.getElementById('recipient-form').style.display = 'block';
            document.getElementById('recipient-form').scrollIntoView({ behavior: 'smooth' });
            updatePriceSummary();
        }

        // é¸æŠã‚’å¤‰æ›´
        function changeSelection() {
            document.getElementById('confirmation-section').style.display = 'none';
            document.getElementById('recipient-form').style.display = 'none';
            selectedGift = null;
            
            document.querySelectorAll('.gift-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        // ä¾¡æ ¼ã‚µãƒãƒªãƒ¼ã®æ›´æ–°
        function updatePriceSummary() {
            if (!selectedGift) return;

            let totalPrice = selectedGift.price;
            const selectedOptions = document.querySelectorAll('input[name="options"]:checked');
            
            selectedOptions.forEach(option => {
                if (option.value === 'card') {
                    totalPrice += 500;
                } else if (option.value === 'wrapping') {
                    totalPrice += 1000;
                }
            });

            const priceSummary = document.getElementById('price-summary');
            if (priceSummary) {
                priceSummary.innerHTML = `
                    <div class="price-breakdown">
                        <h3>æ–™é‡‘å†…è¨³</h3>
                        <div class="price-item">
                            <span>${selectedGift.name}</span>
                            <span>Â¥${selectedGift.price.toLocaleString()}</span>
                        </div>
                        ${selectedOptions.length > 0 ? selectedOptions.map(option => {
                            const optionName = option.value === 'card' ? 'ã‚®ãƒ•ãƒˆã‚«ãƒ¼ãƒ‰' : 'ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹';
                            const optionPrice = option.value === 'card' ? 500 : 1000;
                            return `<div class="price-item">
                                <span>${optionName}</span>
                                <span>Â¥${optionPrice.toLocaleString()}</span>
                            </div>`;
                        }).join('') : ''}
                        <div class="price-total">
                            <strong>åˆè¨ˆ</strong>
                            <strong>Â¥${totalPrice.toLocaleString()}</strong>
                        </div>
                    </div>
                `;
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
        function handleFormSubmit(e) {
            e.preventDefault();
            
            if (!selectedGift) {
                showAlert('ã‚®ãƒ•ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                return;
            }

            const formData = new FormData(e.target);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }

            console.log('é€ä¿¡ãƒ‡ãƒ¼ã‚¿:', { ...data, gift: selectedGift });
            
            // æ±ºæ¸ˆå‡¦ç†ã‚’é–‹å§‹
            processPayment();
        }

        // æˆ»ã‚‹ãƒœã‚¿ãƒ³
        function goBack() {
            if (document.getElementById('recipient-form').style.display !== 'none') {
                document.getElementById('recipient-form').style.display = 'none';
                document.getElementById('confirmation-section').style.display = 'block';
            } else if (document.getElementById('confirmation-section').style.display !== 'none') {
                changeSelection();
            }
        }
    </script>

    <style>
        .selected-gift-details {
            text-align: center;
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .confirmation-actions {
            text-align: center;
            margin-top: 1rem;
        }

        .price-breakdown {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1rem;
        }

        .price-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .price-total {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #e1e5e9;
            font-size: 1.2rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .text-center {
            text-align: center;
        }
    </style>
</body>
</html> 