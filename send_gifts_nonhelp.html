<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ギフトを選択 - GIFT</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- ヘッダー -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">🎁 GIFT</a>
            <nav>
                <ul class="nav-menu">
                    <li><a href="about.html">GIFTについて</a></li>
                    <li><a href="send_gifts.html">ギフトを送る</a></li>
                    <li><a href="mypage.html">マイページ</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- メインコンテンツ -->
    <main class="main-content">
        <!-- ステップインジケーター -->
        <section class="step-indicator">
            <div class="step active">
                <div class="step-number">1</div>
                <span>ギフトを選択</span>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <span>相手の情報を入力</span>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <span>決済完了</span>
            </div>
        </section>

        <!-- ギフト選択セクション -->
        <section class="gift-selection">
            <div class="card">
                <h2>ギフトを選択してください</h2>
                <p>送りたい健康診断やサービスをお選びください</p>
                
                <div class="grid grid-3" id="gift-container">
                    <!-- JavaScriptで動的に生成 -->
                </div>
            </div>
        </section>

        <!-- 選択確認セクション -->
        <section class="selection-confirmation" id="confirmation-section" style="display: none;">
            <div class="card">
                <h2>選択したギフトの確認</h2>
                <div id="selected-gift-info">
                    <!-- 選択されたギフトの情報を表示 -->
                </div>
            </div>
        </section>

        <!-- 相手情報入力フォーム -->
        <section class="recipient-form" id="recipient-form" style="display: none;">
            <div class="card">
                <h2>相手の情報を入力してください</h2>
                <form id="gift-form">
                    <div class="form-group">
                        <label for="recipient-name">お名前 *</label>
                        <input type="text" id="recipient-name" name="recipientName" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="recipient-email">メールアドレス *</label>
                        <input type="email" id="recipient-email" name="recipientEmail" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="recipient-phone">電話番号</label>
                        <input type="tel" id="recipient-phone" name="recipientPhone" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="message">メッセージ</label>
                        <textarea id="message" name="message" class="form-control" rows="4" placeholder="相手へのメッセージを入力してください（任意）"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="delivery-date">希望配達日</label>
                        <input type="date" id="delivery-date" name="deliveryDate" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>配達方法</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="delivery-email" name="deliveryMethod" value="email" checked>
                                <label for="delivery-email">メール配達（即座に配達）</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="delivery-scheduled" name="deliveryMethod" value="scheduled">
                                <label for="delivery-scheduled">指定日時配達</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>オプション</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="option-card" name="options" value="card">
                                <label for="option-card">ギフトカード付き（+¥500）</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="option-wrapping" name="options" value="wrapping">
                                <label for="option-wrapping">ラッピングサービス（+¥1,000）</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="price-summary" id="price-summary">
                        <!-- 価格サマリーを表示 -->
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="goBack()">戻る</button>
                        <button type="submit" class="btn btn-success">決済に進む</button>
                    </div>
                </form>
            </div>
        </section>
    </main>

    <!-- フッター -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2024 GIFT. All rights reserved.</p>
            <p>大切な人へ健康を贈る - GIFT</p>
        </div>
    </footer>

    <script src="js/script.js"></script>
    <script>
        let selectedGift = null;
        let currentStep = 1;

        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            initGiftSelection();
            initFormHandlers();
        });

        // ギフト選択の初期化
        function initGiftSelection() {
            const giftContainer = document.getElementById('gift-container');
            if (!giftContainer) return;

            const giftHTML = giftData.gifts.map(gift => `
                <div class="gift-card" data-gift-id="${gift.id}" onclick="selectGift(${gift.id})">
                    <div class="icon">${gift.icon}</div>
                    <h3>${gift.name}</h3>
                    <p>${gift.description}</p>
                    <div class="price">¥${gift.price.toLocaleString()}</div>
                </div>
            `).join('');

            giftContainer.innerHTML = giftHTML;
        }

        // フォームハンドラーの初期化
        function initFormHandlers() {
            const form = document.getElementById('gift-form');
            if (form) {
                form.addEventListener('submit', handleFormSubmit);
            }

            // オプション変更時の価格更新
            const optionCheckboxes = document.querySelectorAll('input[name="options"]');
            optionCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updatePriceSummary);
            });
        }

        // ギフト選択処理
        function selectGift(giftId) {
            selectedGift = giftData.gifts.find(gift => gift.id === giftId);
            
            // 選択状態の視覚的フィードバック
            document.querySelectorAll('.gift-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            const selectedCard = document.querySelector(`[data-gift-id="${giftId}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }

            // 選択確認セクションを表示
            showConfirmation();
            
            console.log('選択されたギフト:', selectedGift);
        }

        // 選択確認の表示
        function showConfirmation() {
            const confirmationSection = document.getElementById('confirmation-section');
            const selectedGiftInfo = document.getElementById('selected-gift-info');
            
            if (selectedGift && confirmationSection && selectedGiftInfo) {
                selectedGiftInfo.innerHTML = `
                    <div class="selected-gift-details">
                        <div class="icon">${selectedGift.icon}</div>
                        <h3>${selectedGift.name}</h3>
                        <p>${selectedGift.description}</p>
                        <div class="price">¥${selectedGift.price.toLocaleString()}</div>
                    </div>
                    <div class="confirmation-actions">
                        <button class="btn btn-success" onclick="proceedToForm()">このギフトで進む</button>
                        <button class="btn btn-secondary" onclick="changeSelection()">選択を変更</button>
                    </div>
                `;
                
                confirmationSection.style.display = 'block';
                confirmationSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // フォームに進む
        function proceedToForm() {
            document.getElementById('recipient-form').style.display = 'block';
            document.getElementById('recipient-form').scrollIntoView({ behavior: 'smooth' });
            updatePriceSummary();
        }

        // 選択を変更
        function changeSelection() {
            document.getElementById('confirmation-section').style.display = 'none';
            document.getElementById('recipient-form').style.display = 'none';
            selectedGift = null;
            
            document.querySelectorAll('.gift-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        // 価格サマリーの更新
        function updatePriceSummary() {
            if (!selectedGift) return;

            let totalPrice = selectedGift.price;
            const selectedOptions = document.querySelectorAll('input[name="options"]:checked');
            
            selectedOptions.forEach(option => {
                if (option.value === 'card') {
                    totalPrice += 500;
                } else if (option.value === 'wrapping') {
                    totalPrice += 1000;
                }
            });

            const priceSummary = document.getElementById('price-summary');
            if (priceSummary) {
                priceSummary.innerHTML = `
                    <div class="price-breakdown">
                        <h3>料金内訳</h3>
                        <div class="price-item">
                            <span>${selectedGift.name}</span>
                            <span>¥${selectedGift.price.toLocaleString()}</span>
                        </div>
                        ${selectedOptions.length > 0 ? selectedOptions.map(option => {
                            const optionName = option.value === 'card' ? 'ギフトカード' : 'ラッピングサービス';
                            const optionPrice = option.value === 'card' ? 500 : 1000;
                            return `<div class="price-item">
                                <span>${optionName}</span>
                                <span>¥${optionPrice.toLocaleString()}</span>
                            </div>`;
                        }).join('') : ''}
                        <div class="price-total">
                            <strong>合計</strong>
                            <strong>¥${totalPrice.toLocaleString()}</strong>
                        </div>
                    </div>
                `;
            }
        }

        // フォーム送信処理
        function handleFormSubmit(e) {
            e.preventDefault();
            
            if (!selectedGift) {
                showAlert('ギフトを選択してください', 'warning');
                return;
            }

            const formData = new FormData(e.target);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }

            console.log('送信データ:', { ...data, gift: selectedGift });
            
            // 決済処理を開始
            processPayment();
        }

        // 戻るボタン
        function goBack() {
            if (document.getElementById('recipient-form').style.display !== 'none') {
                document.getElementById('recipient-form').style.display = 'none';
                document.getElementById('confirmation-section').style.display = 'block';
            } else if (document.getElementById('confirmation-section').style.display !== 'none') {
                changeSelection();
            }
        }
    </script>

    <style>
        .selected-gift-details {
            text-align: center;
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .confirmation-actions {
            text-align: center;
            margin-top: 1rem;
        }

        .price-breakdown {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1rem;
        }

        .price-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .price-total {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #e1e5e9;
            font-size: 1.2rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .text-center {
            text-align: center;
        }
    </style>
</body>
</html> 